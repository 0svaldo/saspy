

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced topics &mdash; saspy 2.1.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="saspy 2.1.2 documentation" href="index.html"/>
        <link rel="next" title="Contributing new methods" href="adding-procedures.html"/>
        <link rel="prev" title="API Reference" href="api.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> saspy
          

          
          </a>

          
            
            
              <div class="version">
                2.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of SASPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation and configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-batch-mode">Using Batch mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prompting">Prompting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adding-procedures.html">Contributing new methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">saspy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Advanced topics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/advanced-topics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-topics">
<h1>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we will explore more detailed explanations of specific functionality in SASPy.</p>
<div class="section" id="using-batch-mode">
<h2>Using Batch mode<a class="headerlink" href="#using-batch-mode" title="Permalink to this headline">¶</a></h2>
<p>Batch mode is meant to be used when you want to automate your code as Python scripts.</p>
<p>In batch mode, any method that would normally display results, returns a Python dictionary
instead and with two keys; LOG, LST. This is the same as how the submit() method works
normally.</p>
<p>The LOG has the SAS Log and the LST contains the results. You will likely want to set
the results parameter to HTML (this was originally the default instead of Pandas). When
you set the results to HTML, not only are plots and graphs in HTML, but also tabular results
too.</p>
<p>The example below shows the contents of a Python script that runs a linear regression and
writes all the results to a directory. You can access the directory with a web browser to
view these results by clicking on them. Adjust the filesystem path below and you should
be able to run this code yourself.</p>
<div class="highlight-ipython3"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/python3.5</span>

<span class="kn">import</span> <span class="nn">saspy</span>
<span class="n">sas</span> <span class="o">=</span> <span class="n">saspy</span><span class="o">.</span><span class="n">SASsession</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">sas</span><span class="o">.</span><span class="n">sasdata</span><span class="p">(</span><span class="s1">&#39;cars&#39;</span><span class="p">,</span> <span class="n">libref</span><span class="o">=</span><span class="s1">&#39;sashelp&#39;</span><span class="p">)</span>

<span class="n">sas</span><span class="o">.</span><span class="n">set_batch</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="n">stat</span> <span class="o">=</span> <span class="n">sas</span><span class="o">.</span><span class="n">sasstat</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">reg</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;horsepower = Cylinders EngineSize&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">cars</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ets_results</span><span class="o">.</span><span class="n">_names</span><span class="p">)):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">out1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Public</span><span class="se">\\</span><span class="s2">saspy_demo</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">res</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+b&#39;</span><span class="p">)</span>
        <span class="n">out1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;LST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">out1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Public</span><span class="se">\\</span><span class="s2">saspy_demo</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">res</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.log&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+b&#39;</span><span class="p">)</span>
        <span class="n">out1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">out1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The URL to see these results is: <a class="reference external" href="file:///C:/Public/saspy_demo/">file:///C:/Public/saspy_demo/</a>. Of course, you can
imagine integrating the results into nicer web page for reporting, but with nothing more
than this few lines of code, you can have the results updated and refreshed by just
re-running the script.</p>
</div>
<div class="section" id="prompting">
<h2>Prompting<a class="headerlink" href="#prompting" title="Permalink to this headline">¶</a></h2>
<p>There are two types of prompting that SASPy can perform&#8211;meaning to stop processing and
prompt the user for input and then resume processing.</p>
<p>The first type of prompting is performed by SASPy on its own. When you run the
SASsession() method, if any required parameters for the chosen connection method
were not specified in the configuration definition (in sascfg.py), SASPy interrupts
processing so that it can prompt for the missing parameters. In addition, when there
is more than one configuration definition in SAS_config_names, and cfgname is not
specified in the SASsession() method (or an invalid name is specified), SASPy
prompts the user to select the configuration definition to use.</p>
<p>The other kind of prompting is prompting that you control. The submit() method,
and the saslib() methods both take an optional prompt parameter. This parameter
is how you request that SASPy prompts the user for input at run time. This option
is used in conjunction with SAS macro variable names that you enter in the SAS
code or options for the method.</p>
<p>The prompt parameter takes a Python dictionary. The keys are the SAS macro variable
names and the values are True or False. The Boolean value tells SASPy whether it
is to hide what the user types in or not. It also controls whether the macro variables
stay available to the SAS session or if they are deleted after running that code.</p>
<p>SASPy prompts you for the values of your keys, and will then assign those values to
SAS macro variables for you in SAS. When your code runs, the macro variables will be
resolved. If you specified <code class="docutils literal"><span class="pre">True</span></code>, then the value the user types is not displayed,
nor is the macro variable displayed in the SAS log, and the macro variable is deleted
from SAS so that it is not accessible after that code submission. For <code class="docutils literal"><span class="pre">False</span></code>, the
user can see the value as it is type, the macro variables can be seen in the SAS log
and the variables remain available in that SAS session for later code submissions.</p>
<p>The following are examples of how to use prompting in your programs. The first example
uses the saslib() method to assign a libref to a third-party database. This is a
common issue&#8211;the user needs to specify credentials, but you do not want to include
user IDs and passwords in your programs. Prompting enables the user to provide
credentials at runtime.</p>
<div class="highlight-ipython3"><div class="highlight"><pre><span></span><span class="n">sas</span><span class="o">.</span><span class="n">saslib</span><span class="p">(</span><span class="s1">&#39;Tera&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;Teradata&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;user=&amp;user pw=&amp;mypw server=teracop1&#39;</span><span class="p">,</span>
           <span class="n">prompt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;mypw&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</pre></div>
</div>
<p>At runtime, the user is prompted for user and password and sees something like the
following when entering values (the user ID is visible and the password is obscured):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Please</span> <span class="n">enter</span> <span class="n">value</span> <span class="k">for</span> <span class="n">macro</span> <span class="n">variable</span> <span class="n">user</span> <span class="n">sasdemo</span>
<span class="n">Please</span> <span class="n">enter</span> <span class="n">value</span> <span class="k">for</span> <span class="n">macro</span> <span class="n">variable</span> <span class="n">mypw</span> <span class="o">........</span>
</pre></div>
</div>
<p>Another example might be that you have code that creates a table, but you want to let
the user choose the table name as well as the name of the column and a hidden value
to assign to it. By specifing <code class="docutils literal"><span class="pre">False</span></code>, the user can see the value, and the SAS log
shows the non-hidden marco mariables, followed by another code submission that uses
the previously defined non-hidden variables&#8211;which are still available.</p>
<div class="highlight-ipython3"><div class="highlight"><pre><span></span><span class="n">ll</span> <span class="o">=</span> <span class="n">sas</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">data &amp;dsname;</span>
<span class="s1">  do &amp;var1=&quot;&amp;pw&quot;;</span>
<span class="s1">    output;</span>
<span class="s1">  end;</span>
<span class="s1">run;</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;var1&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;pw&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;dsname&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>Please enter value for macro variable var1 MyColumnName
Please enter value for macro variable hidden ........
Please enter value for macro variable dsname TestTable1

print(ll[&#39;LOG&#39;])

103  ods listing close;ods html5 (id=saspy_internal) file=stdout options(bitmap_mode=&#39;inline&#39;) device=svg; ods graphics on /
103! outputfmt=png;
NOTE: Writing HTML5(SASPY_INTERNAL) Body file: STDOUT
104
105  options nosource nonotes;
108  %let var1=MyColumnName;
109  %let dsname=TestTable1;
110
111  data &amp;dsname;
112    do &amp;var1=&quot;&amp;hidden&quot;;
113      output;
114    end;
115  run;
NOTE: The data set WORK.TESTTABLE1 has 1 observations and 1 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds

116
117  proc print data=&amp;dsname;
118  run;
NOTE: There were 1 observations read from the data set WORK.TESTTABLE1.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds

119
120  options nosource nonotes;
123
124  ods html5 (id=saspy_internal) close;ods listing;


HTML(sas.submit(&#39;&#39;&#39;
proc print data=&amp;dsname;
run;
&#39;&#39;&#39;)[&#39;LST&#39;])

Obs     MyColumnName
1       cant see me
</pre></div>
</div>
<p>That is a highly contrived example, but you get the idea. You can prompt users
at runtime for values you want to use in the code, and those values can be
kept around and used later in the code, or hidden and inaccessible afterward.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="adding-procedures.html" class="btn btn-neutral float-right" title="Contributing new methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.html" class="btn btn-neutral" title="API Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 SAS Institute Inc. All Rights Reserved..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.1.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>